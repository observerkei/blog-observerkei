---
title: 
date: 2024-03-30
tags:
  - Note
draft: false
permalink: /11
comments: true
---
> `Update:` 2024.12.28 å°è¯•å¼•å…¥ [`Github discussions`](https://github.com/observerkei/blog-observerkei/discussions)  - `Giscus` è¯„è®ºç³»ç»Ÿ.

# ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªç³»ç»Ÿ

1. å› ä¸º `Quartz` æš‚æ—¶è¿˜ä¸æ”¯æŒè¯„è®ºåŠŸèƒ½
2. å¦‚æœæœ‰è¯„è®ºçš„è¯èƒ½å¤Ÿæ›´æ–¹ä¾¿çš„å¾—åˆ°åé¦ˆ
3. ä¾èµ–è¯„è®ºç³»ç»Ÿï¼Œå¯ä»¥é¡ºä¾¿æ”¯æŒè®¿é—®ç»Ÿè®¡ã€è®¿å®¢å°è±¡ç­‰ä¿¡æ¯ã€‚

è¿½åŠ æœ¬åšå®¢ `Giscus` é…ç½®æ–¹æ³•ï¼š[[#ä½¿ç”¨`Giscus`è¯„è®ºç³»ç»Ÿ]]

# ä½¿ç”¨ `Waline` è¿›è¡Œè¯„è®ºç³»ç»Ÿçš„æ­å»º

> ä¸ºä»€ä¹ˆè¦ç”¨ `Waline` ?   ~~å› ä¸ºæˆæœ¬ä½~~ ï¼Œ ~~å› ä¸ºæ­å»ºèµ·æ¥æ–¹ä¾¿~~ï¼Œ å› ä¸ºç›®å‰åªæ‰¾åˆ°è¿™ä¸ªæœ€åˆé€‚

## ç®€è¦æ è¿‡ä¸€ä¸‹æ­å»ºè¿‡ç¨‹

 - `Waline` [æœåŠ¡ç«¯é…ç½®](https://Waline.js.org/guide/get-started/)
 - `Waline` [å®¢æˆ·ç«¯é…ç½®](https://Waline.js.org/cookbook/import/cdn.html)
 - æ¥å…¥åšå®¢



# `Waline`æ¥å…¥`Quartz`åšå®¢æ–¹æ³•

## ç®€å•æ–¹æ³•

ç›´æ¥ç²˜è´´ä¸€ä¸‹ä»£ç æ®µåˆ°ä½ çš„markdownç¬”è®°ä¸­å³å¯ã€‚

å¯ä»¥è®©AIå¸®å¿™å†™ä¸ªè„šæœ¬åœ¨å‘å¸ƒå‰æ‰‹åŠ¨æ‰§è¡Œä¸€ä¸‹å°±èƒ½è‡ªåŠ¨æ’å…¥ä»£ç ï¼ˆæ³¨æ„è¦æ£€æµ‹æ˜¯å¦å·²ç»æ’å…¥è¿‡ï¼Œä¸è¦é‡å¤æ’å…¥ï¼Œå¯ä»¥è¿‡æ»¤æ˜¯å¦å­˜åœ¨`https://unpkg.com/@Waline/client@v3/dist/Waline.js` ï¼Œå­˜åœ¨å°±ä¸é‡å¤æ’å…¥ï¼Œå¹¶ä¸”è¦äº‹å…ˆåšå¥½æ•°æ®å¤‡ä»½ï¼Œé˜²æ­¢æŠŠæ–‡ä»¶å†™åã€‚ï¼‰

æŠŠ `æ¢æˆä½ éƒ¨ç½²çš„æœåŠ¡ç«¯url` æ¢æˆä½ å®é™…ä¸Šéƒ¨ç½²çš„å®¢æˆ·ç«¯URLå³å¯

å¹¶ä¸” `dark: 'html[saved-theme=\'dark\']',`  ï¼ˆ~~`Quartz` ä¸è¦å†™åŒå¼•å·,ä¼šè¢«è¿‡æ»¤çš„~~ ï¼‰ è¦æ¢æˆä½ å®é™…ä½¿ç”¨åšå®¢çš„ä¸»é¢˜å˜æ¢æ ·å¼ï¼Œå…·ä½“[åœ¨è¿™é‡Œçœ‹æè¿°](https://Waline.js.org/reference/client/props.html#dark),ä»¥ä¾¿æ”¯æŒåŠ¨æ€è·Ÿéšç³»ç»Ÿåˆ‡æ¢æš—é»‘æ¨¡å¼ã€‚

```javascript

---

<comment>
  <div id="Waline"></div>
  <link
    rel="stylesheet"
    href="https://unpkg.com/@Waline/client@v3/dist/Waline.css"
  />
  <script type="module">
    import { init } from 'https://unpkg.com/@Waline/client@v3/dist/Waline.js';
    init({
      el: '#Waline',
      dark: 'html[saved-theme=\'dark\']',
      serverURL: '{æ¢æˆä½ éƒ¨ç½²çš„å®¢æˆ·ç«¯url}',
    });
  </script>
</comment>

```

## å°è£…`Waline`è¯„è®ºæˆä¸º`Quartz`ç»„ä»¶çš„æ–¹æ³•

å› ä¸º[æ­¤åšå®¢](https://blog.observerkei.top/)ç”¨çš„æ˜¯ `Quartz` ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ç¼–å†™ç»„ä»¶çš„æ–¹å¼æ¥æ”¯æŒæ‰€æœ‰é¡µé¢è‡ªåŠ¨æ’å…¥å¯¹åº”çš„ `Waline` ç»„ä»¶ï¼Œå®ç°è‡ªåŠ¨å±•ç¤ºè¯„è®ºã€‚ 
### `Quartz` çš„æ¡†æ¶å®ç°

ä¸ºäº†å†™`Quartz`çš„ç»„ä»¶ï¼Œ é¦–å…ˆè¦çœ‹ä¸‹å®ƒçš„å®ç°æ¡†æ¶ï¼š  [Architecture (jzhao.xyz)](https://Quartz.jzhao.xyz/advanced/architecture)

ç®€å•æ¥è¯´å°±æ˜¯ä¾èµ– `bootstrap-cli.mjs` å®ç°äº†`markdown`æ–‡æœ¬è§£æï¼Œå¹¶æ³¨å†Œäº†ä¸€å¤§å †å¤æ‚çš„å›è°ƒç»“æ„å’Œé’©å­ï¼Œåœ¨æ”¯æŒPreactæ¡†æ¶çš„æƒ…å†µä¸‹ï¼Œå®ç°åœ¨æ–‡æœ¬è½¬æ¢ã€å¯¹è±¡å‰å’Œåæ„å»ºçš„æ—¶å€™æ‰§è¡Œä¸€äº›`javascript`ä»£ç å®ç°å¯¹é™æ€é¡µé¢å†…å®¹çš„åŠ¨æ€è°ƒæ•´ï¼ŒåŒæ—¶ä¾èµ– `SPA` æ¡†æ¶å®ç°åªåŠ è½½éƒ¨åˆ†é¡µé¢æå‡è®¿é—®ä½“éªŒã€‚

>åŸºäºä»–å¯ä»¥è°ƒç”¨ `javascript` ä»£ç ã€å†™ `JSX` è¿™ä¸€ç‚¹ï¼Œå°±å¯ä»¥ç¡®å®šï¼Œ**æ„å»º `Waline` `Quartz`ç»„ä»¶çš„æ–¹æ¡ˆæ˜¯å¯è¡Œçš„**ã€‚

### `Quartz` çš„ç»„ä»¶è°ƒç”¨ä½ç½®

`Quartz.layout.ts` é‡Œé¢å®šä¹‰äº†å„ä¸ªç»„ä»¶çš„å¸ƒå±€ï¼Œå…·ä½“å‚è§ï¼š [Layout (jzhao.xyz)](https://Quartz.jzhao.xyz/layout)

å…¶ä¸­é‡Œé¢æœ‰ä¸ª ` Component.Footer()` åº•éƒ¨ç»„ä»¶æ˜¯æœ¬æ¬¡è¦ä¸‹æ‰‹(å‚è€ƒ)çš„å¯¹è±¡ã€‚ 

```javascript
// components shared across all pages
export const sharedPageComponents: SharedLayout = {
Â  head: Component.Head(),
Â  header: [],
Â  footer: Component.Footer(),
}
```

### `Quartz` çš„ç»„ä»¶é›†æˆæ–¹å¼

ç®€å•çœ‹ä¸€ä¸‹è¿™ä¸ª `Footer` ç»„ä»¶ï¼Œç®€å•æ¥è¯´å°±æ˜¯ ä¼ å…¥ äº† ä¸€äº› `Options` çš„ç»“æ„ï¼ˆè¿™ä¸ªç»“æ„å…·ä½“çœ‹è¿™é‡Œ [Creating your own Quartz components (jzhao.xyz)](https://Quartz.jzhao.xyz/advanced/creating-components) ï¼‰ï¼Œ

ç„¶å åœ¨ `JSX` çš„æ”¯æŒä¸‹ï¼Œåœ¨å‡½æ•°å†…å®ç°äº†ç»„ä»¶çš„ç¼–æ’ï¼Œé€šè¿‡ `return` è¿”å›æ„å»ºçš„ç»„ä»¶ `DOM` å†…å®¹ï¼Œä¹Ÿå°±æ˜¯ `Html` å†…å®¹ï¼Œç„¶åå¹¶ä¸”é€šè¿‡ `Footer.css = style` æ–¹å¼æŒ‡å®šæ ·å¼ï¼Œé€šè¿‡ `Footer.afterDOMLoaded = script` æ–¹å¼æŒ‡å®šç»„ä»¶åŠ è½½å®Œæˆåè¦æ‰§è¡Œçš„ `javascript` è„šæœ¬çš„**å­—ç¬¦ä¸²**ä»£ç ï¼ˆ `beforeDOMLoaded` æ˜¯ç»„ä»¶åŠ è½½å‰æ‰§è¡Œçš„ä»£ç  ï¼‰ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬æ¬¡è¦æ”¹ `return` å’Œ `afterDOMLoaded` çš„éƒ¨åˆ†
```javascript
interface Options {
Â  links: Record<string, string>
}

export default ((opts?: Options) => {
Â  const Footer: QuartzComponent = ({ displayClass, cfg }: QuartzComponentProps) => {
Â  Â  const year = new Date().getFullYear()
Â  Â  const links = opts?.links ?? []
Â  Â  return (
Â  Â  Â  <>
		(ä¸­é—´æ )
Â  Â  Â  </>
Â  Â  )
Â  }

Â  Footer.css = style
Â  Footer.afterDOMLoaded = stript
Â  return Footer
}) satisfies QuartzComponentConstructor
```

### æ–°å»º `Waline` ç»„ä»¶

#### `Html` å†…å®¹ç”Ÿæˆ

å‰é¢è®²äº†ä¸ºäº†å®ç° `Waline` è¦å†™ä¸¤éƒ¨åˆ†ï¼Œé¦–å…ˆæ˜¯ `Html` çš„éƒ¨åˆ†ï¼Œ ç›´æ¥æŠŠ `Html` å†™åœ¨ä¸€ä¸ªæ–‡ä»¶å°è£…å¥½ï¼Œè®©å¤–éƒ¨å¯¼å…¥å°±è¡Œï¼Œå†…éƒ¨é€šè¿‡ Link å¼•å…¥äº†è¯„è®ºçš„ `css` æ ·å¼

```javascript
export default () => {
  return (
    <>
      <div id="waline"></div>
      <link
        rel="stylesheet"
        href="https://unpkg.com/@waline/client@v3/dist/waline.css"
      />
    </>
  );
}
```

### `Javascript` ä»£ç ç¼–å†™

å®‰è£…ä¾èµ–

```bash
npm i @waline/client
```


`import` ä¸€ä¸‹ç„¶åç›´æ¥å¯¼å…¥ init ï¼Œä¼ å…¥ `{ä½ çš„Walineå®¢æˆ·ç«¯URL}` å°±èƒ½å®Œæˆåˆå§‹åŒ–ï¼Œç„¶ååˆ·æ–°ä¸‹é¡µé¢å°±èƒ½çœ‹åˆ°è¯„è®ºçš„å‡ºç°ã€‚

```javascript
import { init } from '@waline/client';
init({
  el: '#waline',
  serverURL: '{ä½ çš„Walineå®¢æˆ·ç«¯URL}',
});
```

ä½†æ˜¯è¿™æ ·ä¼šæœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ `Waline` æ˜¯æ”¯æŒé‡å¤è°ƒç”¨ï¼Œè‡ªåŠ¨æ¸…ç†èµ„æºçš„ï¼Œå› ä¸º `Quartz` `SPA` æ”¯æŒçš„ä»£ç å®ç°ä¸­ï¼ŒæŠŠåŸæ¥çš„ `Waline` ä»£ç ä¼šè¦†ç›–æ‰ï¼Œç„¶åä¼šå¯¼è‡´ `Waline` æ¸…ç†èµ„æºå‡ºé—®é¢˜ï¼Œ

ç®€å•æ¥è¯´å°±æ˜¯ä½ åˆ‡æ¢ä¸€ä¸‹å…¶ä»–urlï¼Œä¸åˆ·æ–°ï¼Œå°±åªèƒ½æ˜¾ç¤ºä¸€æ¬¡ï¼Œè§£å†³æ–¹æ³•æ˜¯ä¸»åŠ¨æ¸…ç†èµ„æºï¼Œåˆå› ä¸º `Quartz` çš„ä¼ å‚å’Œä¸Šä¸‹æ–‡ä¿å­˜æ¯”è¾ƒéº»çƒ¦ï¼Œç›´æ¥ç”¨å…¨å±€å˜é‡ä¿å­˜ï¼Œç„¶ååé¢æ£€æµ‹é‡Šæ”¾ï¼Œä»£ç å¦‚ä¸‹ï¼š

```javascript
// èµ„æºæ¸…ç†
function walineContentExit() {
Â  if (window.waline_content_global) {
Â  Â  window.waline_content_global?.destroy()
Â  Â  window.waline_content_global = null
Â  }
}

import { init } from '@waline/client';
window.waline_content_global = init({
  el: '#waline',
  serverURL: '{ä½ çš„Walineå®¢æˆ·ç«¯URL}',
});
Â // é€šè¿‡é˜…è¯» Quartz æºç å¾—çŸ¥ï¼Œæä¾›çš„èµ„æºæ¸…ç†æ–¹å¼ï¼Œ
window?.addCleanup(() => walineContentExit())
```

è¿™æ ·å­å°±èƒ½éšæ„åˆ‡æ¢åˆ‡æ¢æ–‡ä»¶ä¹Ÿèƒ½å±•ç¤ºè¯„è®ºäº†

ç„¶åè¿˜æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œ404 é¡µé¢çš„æ—¶å€™æ£€æµ‹ä¸€ä¸‹ï¼Œä¸éœ€è¦æ·»åŠ è¯„è®ºç»„ä»¶

```javascript
var is_404 = false
var bodyTag = document.querySelector('body');
var dataSlugValue = bodyTag.getAttribute('data-slug');
if (dataSlugValue === "404") {
Â  is_404 = true
}

if (!is_404) {
Â  try {
Â  // ä½ çš„ç»„ä»¶åŠ è½½ä»£ç 
Â  } catch (err) {
Â  // pass
Â  }
}
```

### é€šè¿‡ç»„ä»¶æ–¹å¼æ¥å…¥`Quartz` æ¡†æ¶

 `components/Waline.tsx`

```javascript
import WalineComment from "{åˆšåˆšå¯¼å‡ºçš„DOMæ–‡ä»¶}"
import WalineScript from "{åˆšåˆšå®šä¹‰çš„Javascriptæ–‡ä»¶å­—ç¬¦ä¸²æ–¹å¼å¯¼å…¥}"
/* ... */
export default ((opts?: Options) => {
  const Footer: QuartzComponent = ({ displayClass, cfg }: QuartzComponentProps) => {
    return (
      <>
        <footer /* ... */ >
        <WalineComment />
        </footer>
      </>
    )
  }

   Footer.afterDOMLoaded = WalineScript
   return Footer
}) satisfies QuartzComponentConstructor
```

### å°†ç»„ä»¶å¸ƒå±€åˆ°ç•Œé¢ä¸­å±•ç¤º

`quartz.layout.ts`

```javascript
  
// components shared across all pages
export const sharedPageComponents: SharedLayout = {
Â  /* ... */
Â  footer: Component.Waline(),
}
```

### `Waline` çš„é™„åŠ åŠŸèƒ½

æ–‡ç« ååº”ã€æµè§ˆé‡ç»Ÿè®¡ç­‰åŠŸèƒ½åœ¨è¿™é‡ŒæŸ¥çœ‹ï¼š [åŠŸèƒ½ | Waline](https://waline.js.org/guide/features/)


### æ•´ä½“ `Waline` `Quartz` ä»£ç å®ç°åœ¨è¿™é‡Œ

1. ç»„ä»¶è°ƒç”¨å¤„ï¼š `quartz.layout.ts` ï¼š[quartz.layout.ts (github.com)](https://github.com/observerkei/app_blog/blob/blog/quartz.layout.ts)
3. ç»„ä»¶å®šä¹‰ï¼š `components/Waline.tsx` ï¼š [app_blog/quartz/components/Waline.tsx at blog Â· observerkei/app_blog (github.com)](https://github.com/observerkei/app_blog/blob/blog/quartz/components/Waline.tsx)
4. ç»„ä»¶ `DOM` å’Œå®ç°ä»£ç ï¼šè§ä¸‹é¢


è¯„è®ºçš„å®ç°ä»£ç 

comment-DOM
```javascript
export default () => {
  return (
    <>
      <div id="waline"></div>
    </>
  );
}
```

comment-`Javascript`

```javascript
import { init } from '@waline/client';
import { local } from 'd3';
// èµ„æºæ¸…ç†
function walineContentExit() {
  if (window.waline_content_global) {
    window.waline_content_global?.destroy()
    window.waline_content_global = null
  }
}
// èµ„æºåˆå§‹åŒ–
function walineContentInit() {
  // ä¸åœ¨ä¸»é¡µæ¸²æŸ“
  if (window.location.pathname !== '/') {
    window.waline_content_global = init({
      el: '#waline',
      dark: 'html[saved-theme=\'dark\']',
      serverURL: '{ä½ çš„URLå®¢æˆ·ç«¯}',
      reaction: [
        "ä½ æƒ³æ˜¾ç¤ºçš„æ–‡ç« ååº”å›¾ç‰‡"
      ],
      locale: {
        reactionTitle: ""
      }
    });
    
    window?.addCleanup(() => walineContentExit())
  }
}

export default () => {
Â  // é¦–æ¬¡æ‰§è¡Œ
Â  walineContentInit()
Â  // SPAæ“ä½œé€šçŸ¥çš„æ—¶å€™æ‰§è¡Œ
  document.addEventListener("nav", walineContentInit)
}
```

ç‰¹åˆ«çš„ï¼Œå¦‚æœä½ æƒ³é€šè¿‡  `afterDOMLoaded` /`beforeDOMLoaded`  åŒæ—¶æ‰§è¡Œå¤šä¸ªè„šæœ¬ï¼Œåœ¨å…¶ä»–è„šæœ¬æ˜¯ `export default` æƒ…å†µä¸‹ï¼Œ å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªåœ°æ–¹ç›´æ¥å¼•å…¥è¿™ä¸ªæ–‡ä»¶èµ‹å€¼ç»™  `afterDOMLoaded` /`beforeDOMLoaded`   å±æ€§ï¼ˆ[[#`Quartz` çš„ç»„ä»¶é›†æˆæ–¹å¼|`Quartz` çš„ç»„ä»¶é›†æˆæ–¹å¼]]ï¼‰ï¼š

```javascript
  
import XX from 'xxx.inline'
import BB from 'bbb.inline'

XX()
BB()
```

### è®¾ç½®é‚®ä»¶é€šçŸ¥

å…·ä½“è®¾ç½®æ–¹æ³•åœ¨ï¼š [è¯„è®ºé€šçŸ¥ | Waline](https://waline.js.org/guide/features/notification.html#%E9%82%AE%E4%BB%B6%E9%80%9A%E7%9F%A5) 

è¿™é‡Œå°±ä¸é‡å¤èµ˜è¿°äº†ã€‚


# ä½¿ç”¨ `Giscus` è¯„è®ºç³»ç»Ÿ

å…·ä½“æ•™ç¨‹ï¼š[Comments](https://quartz.jzhao.xyz/features/comments)  
è¿™é‡Œè¡¥å……æ•™ç¨‹é‡Œé¢æ²¡æœ‰çš„ä¸œè¥¿ã€‚  

## è·³è½¬è¯„è®ºé“¾æ¥ä½¿ç”¨çŸ­é“¾

### URLæ”¯æŒçŸ­é“¾è·³è½¬

å› ä¸ºQuartzçš„URLé»˜è®¤ä½¿ç”¨åŒ…å«è·¯å¾„+Markdownæ–‡ä»¶åè¿›è¡Œç½‘é¡µç´¢å¼•ï¼Œå¦‚æœMDæ–‡ä»¶ç§»åŠ¨äº†çš„è¯ï¼ŒåŸæœ‰é“¾æ¥ä¼šéš¾ä»¥ç»´æŠ¤ï¼Œè€ŒQuartzæä¾›çš„[AliasRedirects](https://quartz.jzhao.xyz/plugins/AliasRedirects)ç»„ä»¶å¯ä»¥è§£å†³URLå˜åŒ–çš„é—®é¢˜ã€‚  
åªéœ€è¦åœ¨Markdownæ–‡æ¡£å¼€å¤´æ·»åŠ `permalink`ï¼Œå³å¯æŒ‡å®šçŸ­é“¾ç´¢å¼•ï¼Œå¦‚ä¸‹æ–¹é…ç½®çš„è¯ï¼Œè®¿é—® `blog.observerkei.top/11`ï¼Œå°±èƒ½ç´¢å¼•åˆ°æœ¬ç¬”è®°ã€‚  

```markdown
---
permalink: /11
---
```

### è¯„è®ºä½¿ç”¨çŸ­é“¾è¿›è¡Œç´¢å¼•

åœ¨ç”¨æˆ·è¿›è¡Œè¯„è®ºçš„æ—¶å€™ï¼Œä¼šåœ¨è¯„è®ºé‡Œé¢è‡ªåŠ¨åŠ ä¸Šè¢«è¯„è®ºçš„Markdownç¬”è®°é“¾æ¥ï¼Œè¿™ä¸ªé“¾æ¥é»˜è®¤æ˜¯å½“å‰é¡µé¢çš„URLï¼ˆå¯¹äºQuartzè€Œè¨€æ˜¯é•¿é“¾ï¼‰ï¼Œç°åœ¨æƒ³æ”¹æˆä½¿ç”¨çŸ­é“¾ç´¢å¼•ã€‚  

æ ¹æ®[giscus/ADVANCED-USAGE.md at main Â· giscus/giscus](https://github.com/giscus/giscus/blob/main/ADVANCED-USAGE.md#giscusbacklink)  é‡Œé¢æä¾›çš„é…ç½®æ–¹æ³•ï¼Œ  
å¯ä»¥é€šè¿‡åœ¨ç”Ÿæˆçš„ç¬”è®°ä¸­æ·»åŠ ä»¥ä¸‹`meta`æ ‡ç­¾æ¥æŒ‡å®šè¯„è®ºç´¢å¼•é“¾æ¥ï¼š  

```html
<head>
  <!-- ... -->
  <meta
    name="giscus:backlink"
    content="https://blog.observerkei.top/11"
  >
  <!-- ... -->
</head>
```

é‚£ä¹ˆè¦æ€ä¹ˆå°†ä»¥ä¸Šå†…å®¹å®Œå…¨é›†æˆåˆ°Quartzä¸­ï¼Œå®ç°æ¯æ¬¡å‘å¸ƒåšå®¢çš„æ—¶å€™ï¼Œè‡ªåŠ¨é›†æˆä»¥ä¸Šå†…å®¹å‘¢ï¼Ÿ  
å› ä¸ºQuartzæ˜¯æ”¯æŒè‡ªå®šä¹‰ç»„ä»¶çš„ï¼Œå› æ­¤åªéœ€è¦å†™ä¸€ä¸ªä¸“é—¨æ·»åŠ ä»¥ä¸Š`meta`æ ‡ç­¾çš„ç»„ä»¶å³å¯å®ç°ï¼Œå…¶ä¸­`cfg.baseUrl`æ˜¯å½“å‰é¡µé¢çš„ç½‘å€ï¼Œåœ¨`quartz.config.ts`ä¸­å¯è¿›è¡Œé…ç½®ã€‚  

```typescript
// quartz/components/CreateGiscusBacklink.tsx
import {
  QuartzComponent,
  QuartzComponentConstructor,
  QuartzComponentProps
} from "../../../quartz/components/types"

interface Options {
}

export default ((opts?: Options) => {
  const MetaLink: QuartzComponent = ({ fileData, displayClass, cfg }: QuartzComponentProps) => {
    const permalink = fileData.frontmatter?.permalink;
    if (permalink) {
      return (
        <>
          <meta 
            name="giscus:backlink" 
            content={`https://${cfg.baseUrl}${permalink}`}
          />
        </>
      )
    } else {
      return (<></>)
    }
  }

  // MetaLink.css;
  // MetaLink.afterDOMLoaded;
  return MetaLink
}) satisfies QuartzComponentConstructor
```

ä»£ç é“¾æ¥ï¼š[refactor: add giscus:backlink -> pageTitle.permalink Â· observerkei/app_blog@1064233](https://github.com/observerkei/app_blog/commit/106423342a11e6007840f96c638f6e929a51a110)  

æœ€åï¼Œåœ¨`quartz.layout.ts`ä¸­çš„åˆé€‚ä½ç½®è¿›è¡Œå¼•ç”¨å³å¯

```typescript
// quartz.layout.ts

// components shared across all pages
export const sharedPageComponents: SharedLayout = {
  footer: Custom.CreateGiscusBacklink()
}
```

## æŒ‡å®šé¡µé¢éšè—è¯„è®º

å¦‚æœç›´æ¥åœ¨ `quartz.layout.ts` å¸ƒå±€åº•éƒ¨ä¸­å¼•å…¥è¯„è®ºç»„ä»¶ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´æ‰€æœ‰é¡µé¢éƒ½æœ‰è¯„è®ºï¼Œæ¯”å¦‚404é¡µé¢ã€‚  
ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å¼•å…¥ä¸€ä¸ªæ¡ä»¶æ¸²æŸ“çš„ç»„ä»¶ï¼Œè®©404é¡µé¢ä¸æ˜¾ç¤ºè¯„è®ºï¼Œè¿™é‡Œæœ‰ä»£ç å‚è€ƒï¼š[app_blog/custom/quartz/components/FilterSlugComponent.tsx at blog Â· observerkei/app_blog](https://github.com/observerkei/app_blog/blob/blog/custom/quartz/components/FilterSlugComponent.tsx)  


# æ­å»ºçš„æ—¶å€™ç¢°åˆ°çš„é—®é¢˜

- `Quartz` å¹¶ä¸æ˜¯ä½¿ç”¨ `React` å®ç°çš„ ï¼Œä¸ç›´æ¥æ”¯æŒ `React` è¯­æ³•å’Œç»„ä»¶ï¼Œ
- ä¹Ÿä¸èƒ½ç›´æ¥ä½¿ç”¨ `Vue`ï¼Œä¸æ”¯æŒç›´æ¥å†™ `Vue` ï¼ˆ~~è™½ç„¶æˆ‘ä¹Ÿä¸æ‰“ç®—å†™~~ï¼‰
- éœ€è¦é€šè¿‡ `Javascript` å­—ç¬¦ä¸²ä»£ç å¯¼å…¥æ–¹å¼æ¥å†™ä¸“ç”¨ç»„ä»¶æ‰èƒ½å¤Ÿè¢«è°ƒç”¨ğŸ˜‚ã€‚ç›´æ¥å†™å‡½æ•°ä¸è¡Œï¼Œç›´æ¥ export ä¹Ÿä¸è¡Œï¼Œ`Quartz` æ¡†æ¶ç»„ä»¶ä»£ç æ‰§è¡Œæ–¹å¼é™åˆ¶äº†ä½¿ç”¨æ–¹æ³•ã€‚ä¸Šé¢ç»™å‡ºäº†è§£å†³æ–¹æ³•ã€‚
- ä½ ä¸èƒ½ç›´æ¥åœ¨ä»–å†™çš„ `Html` å¯¼å…¥æ¡†æ¶é‡Œé¢ç›´æ¥å¯¼å…¥ `Waline` 
- `Waline` åœ¨ç»„ä»¶è¿˜åœ¨çš„æ—¶å€™èƒ½é‡å¤åˆå§‹åŒ–ï¼Œä½†æ˜¯ç»„ä»¶è¢«æ¸…ç†ä¹‹åï¼ˆ`Html` çš„éƒ¨åˆ†ï¼‰ï¼Œä¸èƒ½é‡å¤è°ƒç”¨ï¼Œä¼šæŠ¥æ‰¾ä¸åˆ° `DOM` çš„å¼‚å¸¸ï¼Œå› ä¸ºä½¿ç”¨äº† `SPA` ï¼Œ éœ€è¦ä¸»åŠ¨å–é‡Šæ”¾èµ„æºã€‚
- `Quartz` çš„ç»„ä»¶ä¸èƒ½æ–¹ä¾¿çš„äº’ç›¸è°ƒç”¨ï¼Œä¸»è¦æ˜¯è„šæœ¬çš„éƒ¨åˆ†ï¼Œä»–æ˜¯ç›´æ¥ä»¥æ–‡ä»¶æ–¹å¼å¯¼å…¥æˆå­—ç¬¦ä¸²æ–‡æœ¬ï¼Œç„¶åä»¥æ–‡æœ¬æ–¹å¼è§£æ`JavaScript`çš„è„šæœ¬ï¼Œå†å»æ‰§è¡Œï¼Œè¿™æ ·ä½ å†™å¤šä¸ªæ¨¡å—çš„æ—¶å€™ï¼Œå¦‚æœæœ‰å¤šä¸ªè„šæœ¬çš„è¯ï¼Œå°±å¾—å†å†™ä¸ªè„šæœ¬ï¼Œè°ƒç”¨å…¶ä»–è„šæœ¬ä¹‹åï¼Œå†æä¾›ç»™ `Quartz` ç»„ä»¶è°ƒç”¨ï¼Œå› ä¸ºæ˜¯å¤šä¸ªæ–‡ä»¶ï¼Œå°è£…èµ·æ¥ä¸å¤ªä¼˜é›…ã€‚
- `Waline` æ¸²æŸ“ç»„ä»¶é»˜è®¤ç”¨URLè·¯å¾„ï¼Œå¦‚æœåç»­æ–‡ä»¶è·¯å¾„å˜æ›´ï¼Œé‚£ä¹ˆè¯„è®ºå°±ä¼šå¯¹ä¸ä¸Š,ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ `.obsidian` æ’ä»¶ç»™ç¬”è®°è®¡ç®—å”¯ä¸€ `SHA256` ä½œä¸ºIDï¼Œç„¶åè®©`Waline`åˆå§‹åŒ–æ—¶å€™`path` ä¼ å…¥è¿™ä¸ªIDè§£å†³ï¼›
- å¦‚æœè®¿é—® 404 é¡µé¢ï¼Œå…¶å®ä¹Ÿä¼šæ˜¾ç¤ºè¯„è®ºç»„ä»¶ï¼Œéœ€è¦è°ƒæ•´æ˜¾ç¤ºç­–ç•¥ï¼Œå…·ä½“æ€ä¹ˆåšè§ä¸Šé¢ä»£ç ã€‚


> ~~åŸæœ¬ä¸æƒ³æŠ˜è…¾è¿™ä¸ªæ’ä»¶çš„ï¼Œ~~ä» `Quartz` çš„å¤æ‚æ’ä»¶ä¼ é€’æ–¹å¼æ¥çœ‹ä»–é™åˆ¶ä½äº†å®¢æˆ·ç«¯ç¼–å†™ JSX ä»£ç çš„çš„çµæ´»æ€§ï¼ˆç›®å‰å¿…é¡»é€šè¿‡`å­—ç¬¦ä¸²`å¼•å…¥ä»£ç ï¼‰ï¼Œè¿™æ˜¯åç»­å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼ˆå°±åƒä¸Šé¢æä¾›çš„æ”¾åœ¨ä¸€ä¸ªè„šæœ¬é‡Œé¢çš„æ–¹æ³•å…¶å®å°±å¯ä»¥åœ¨å†…éƒ¨è¿›è¡Œå°è£…ï¼‰ï¼Œ ä»¥åŠ `DOM` å’Œä»–é…å¥—çš„ `Javascript` ä»£ç åˆ†å¼€å­˜æ”¾å°±ä¼šå¯¼è‡´é¡¹ç›®æ–‡ä»¶å˜å¾—å¾ˆå¤šï¼Œä¸æ˜“é˜…è¯»ï¼ˆå®é™…ä¸Šä½ è¦æ”¹ç›¸å…³ä»£ç ä¹Ÿå¾—ä¸¤ä¸ªéƒ¨åˆ†ä¸€èµ·çœ‹æ‰èƒ½ä¸‹æ‰‹ï¼‰ï¼Œå¯èƒ½æ˜¯å‡ºäºæ€§èƒ½è€ƒè™‘æ‰€ä»¥æ²¡æœ‰ç”¨ `React` å§ï¼ˆ~~éšç€è®¾å¤‡æ€§èƒ½çš„æé«˜å¥½åƒä¹Ÿä¸ä¼šå·®å¤šå°‘~~ï¼‰ï¼Œ


> è™½è¯´å¦‚æ­¤ï¼Œ`Quartz` ç¡®å®æ˜¯ä¸ªå¥½çš„å¼€æºé¡¹ç›®ï¼Œå‰é¢è¯´çš„åªæ˜¯ä¸€äº›ç»†èŠ‚ä¸Šå¯ä»¥ä¼˜åŒ–çš„ç‚¹ï¼Œä½¿ç”¨ `Javascript` åœ¨æµè§ˆå™¨çš„æ”¯æŒä¸‹å¯ä»¥é€šè¿‡`B/S`æ¶æ„æä¾›è‰¯å¥½çš„è·¨å¹³å°ç‰¹æ€§ï¼Œå®ƒèƒ½çµæ´»çš„è®¾å®šç§»åŠ¨ç«¯å’Œæ¡Œé¢çš„æ˜¾ç¤ºç»„ä»¶ï¼Œæ”¯æŒæš—é»‘æ¨¡å¼ï¼Œå¹¶ä¸”æä¾›äº†æ’ä»¶å’Œç»„ä»¶çš„è‡ªå®šä¹‰æ‹“å±•æ–¹å¼ï¼Œå¢å¼ºäº†æ‹“å±•æ€§å’ŒåŠŸèƒ½æ€§ï¼Œæ›´æ˜“äºå»¶é•¿é¡¹ç›®çš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ç°ä»£ç å¤ç”¨ï¼Œåœ¨ç»„ä»¶åŒ–çš„æ”¯æŒä¸‹å¯ä»¥å®ç°å¾ˆå¤šåŠŸèƒ½æ‹“å±•ï¼ˆ ~~æ¯”å¦‚è¯„è®ºåŠŸèƒ½~~ ï¼‰ã€‚


[*****](WB/Develop/CPP%20BEA/9.3%20æ„å»ºå’Œå…¬ç½‘éƒ¨ç½²åšå®¢/9.3%20æ„å»ºå’Œå…¬ç½‘éƒ¨ç½²åšå®¢.md)
